syntax = "proto3";
package service.metadata.types;

import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";

option go_package = "github.com/bnb-chain/greenfield-storage-provider/metadata/types";

// Bucket is the structure for user bucket
message Bucket {
  // owner is the account address of bucket creator, it is also the bucket owner.
  string owner = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // bucket_name is a globally unique name of bucket
  string bucket_name = 2;
  // is_public defines the highest permissions for bucket. When the bucket is public, everyone can get the object in it.
  bool is_public = 3;
  // id is the unique identification for bucket.
  string id = 4;
  SourceType source_type = 5;
  // create_at defines the block number when the bucket created.
  int64 create_at = 6;
  // payment_address is the address of the payment account
  string payment_address = 7 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // primary_sp_address is the address of the primary sp. Objects belongs to this bucket will never
  // leave this SP, unless you explicitly shift them to another SP.
  string primary_sp_address = 8 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // read_quota defines the traffic quota for read
  ReadQuota read_quota = 9;
  // payment_price_time defines the price time of payment transaction
  int64 payment_price_time = 10;
  // payment_out_flows defines the out flow of payment in USD
  repeated OutFlowInUSD payment_out_flows = 11 [(gogoproto.nullable) = false];
}

// RedundancyType defines the type of the redundancy which can be multi-replication or EC
enum RedundancyType {
  option (gogoproto.goproto_enum_prefix) = false;

  REDUNDANCY_TYPE_REPLICA_UNSPECIFIED = 0;
  REDUNDANCY_TYPE_EC = 1;
  REDUNDANCY_TYPE_INLINE = 2;
}

//ObjectStatus defines the upload status of the object.
enum ObjectStatus {
  option (gogoproto.goproto_enum_prefix) = false;

  OBJECT_STATUS_INIT_UNSPECIFIED = 0;
  OBJECT_STATUS_IN_SERVICE = 1;
}

//SourceType defines the source of the object
enum SourceType {
  option (gogoproto.goproto_enum_prefix) = false;

  SOURCE_TYPE_ORIGIN_UNSPECIFIED = 0;
  SOURCE_TYPE_BSC_CROSS_CHAIN = 1;
}

//ReadQuota defines the traffic quota for read in bytes per month
enum ReadQuota {
  option (gogoproto.goproto_enum_prefix) = false;

  READ_QUOTA_FREE_UNSPECIFIED = 0;
  READ_QUOTA_1G = 1;
  READ_QUOTA_10G = 2;
}

// Object is the structure for user object
message Object {
  // owner is the account address of object creator, it is also the object owner
  string owner = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // bucket_name is the name of the bucket
  string bucket_name = 2;
  // object_name is the name of object
  string object_name = 3;
  // id is the unique identifier of object
  string id = 4;
  // payload_size is the total size of the object payload
  uint64 payload_size = 5;
  // is_public defines the highest permissions for object. When the object is public, everyone can access it.
  bool is_public = 6;
  // content_type defines the format of the object which should be a standard MIME type.
  string content_type = 7;
  // create_at defines the block number when the object created
  int64 create_at = 8;
  // object_status defines the upload status of the object.
  ObjectStatus object_status = 9;
  // redundancy_type defines the type of the redundancy which can be multi-replication or EC.
  RedundancyType redundancy_type = 10;
  // source_type defines the source of the object.
  SourceType source_type = 11;
  // checksums defines the root hash of the pieces which stored in a SP.
  repeated bytes checksums = 12;
  // secondary_sp_addresses defines the addresses of secondary_sps
  repeated string secondary_sp_addresses = 13 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // lockedBalance defines locked balance of object
  string locked_balance = 14;
}

// OutFlowInUSD defines the accumulative outflow stream rate in USD
// from a stream account or a bucket to a SP
message OutFlowInUSD {
  // sp_address defines SP(service provider) stream account address
  string sp_address = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // rate defines flow rate in USD
  string rate = 2;
}

// MetadataServiceGetUserBucketsRequest is request type for the GetUserBuckets RPC method.
message MetadataServiceGetUserBucketsRequest {
  // account_id is the account address of user
  string account_id = 1;
}

// MetadataServiceListObjectsByBucketNameRequest is request type for the ListObjectsByBucketName RPC method
message MetadataServiceListObjectsByBucketNameRequest {
  // bucket_name is the name of the bucket
  string bucket_name = 1;
  // account_id is the account address of user
  string account_id = 2;
}

// MetadataServiceGetUserBucketsResponse is response type for the GetUserBuckets RPC method.
message MetadataServiceGetUserBucketsResponse {
  // buckets defines the list of bucket
  repeated Bucket buckets = 1;
}

// MetadataServiceListObjectsByBucketNameResponse is response type for the ListObjectsByBucketName RPC method.
message MetadataServiceListObjectsByBucketNameResponse {
  // objects defines the list of object
  repeated Object objects = 1;
}

// MetadataService defines the gRPC service of metadata
service MetadataService {
  // GetUserBuckets get buckets info by a user address
  rpc GetUserBuckets(MetadataServiceGetUserBucketsRequest) returns (MetadataServiceGetUserBucketsResponse) {};
  // ListObjectsByBucketName list objects info by a bucket name
  rpc ListObjectsByBucketName(MetadataServiceListObjectsByBucketNameRequest) returns (MetadataServiceListObjectsByBucketNameResponse) {};
}