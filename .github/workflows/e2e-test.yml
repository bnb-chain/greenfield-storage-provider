name: E2E Test

on:
  push:
    branches:
      - master
      - develop
      - release*

  pull_request:
    branches:
      - master
      - develop
      - release*

env:
  MYSQL_USER: root
  MYSQL_PASSWORD: root
  MYSQL_ROOT_PASSWORD: root

jobs:
  create-databases:
    runs-on: ubuntu-latest

    steps:
      - name: Set up MySQL service
        uses: mysql/setup-mysql@v2
        with:
          mysql-version: '5.7'
          mysql-root-password: ${{ env.MYSQL_ROOT_PASSWORD }}
          mysql-user: ${{ env.MYSQL_USER }}
          mysql-password: ${{ env.MYSQL_PASSWORD }}
      - name: Create Databases
        run: |
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -e "CREATE DATABASE sp_0; CREATE DATABASE sp2; CREATE DATABASE sp_3; CREATE DATABASE sp_4; CREATE DATABASE sp_5; CREATE DATABASE sp_6;"

  test-databases:
    needs: create-databases
    runs-on: ubuntu-latest

    steps:
      # Set up MySQL service
      - name: Set up MySQL service
        uses: mysql/setup-mysql@v2
        with:
          mysql-version: '5.7'
          mysql-root-password: ${{ env.MYSQL_ROOT_PASSWORD }}
          mysql-user: ${{ env.MYSQL_USER }}
          mysql-password: ${{ env.MYSQL_PASSWORD }}

      # Test databases
      - name: Test databases
        run: |
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db0 -e "CREATE TABLE table1 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db1 -e "CREATE TABLE table1 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db2 -e "CREATE TABLE table2 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db3 -e "CREATE TABLE table3 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db4 -e "CREATE TABLE table1 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db5 -e "CREATE TABLE table2 (col1 INT);"
          mysql -h localhost -P 3306 -u ${{ env.MYSQL_USER }} -p"${{ env.MYSQL_PASSWORD }}" -D db6 -e "CREATE TABLE table3 (col1 INT);"